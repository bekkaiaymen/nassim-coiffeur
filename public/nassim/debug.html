<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Nassim</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0A0A0A;
            color: white;
            padding: 20px;
            line-height: 1.6;
        }
        .status {
            background: #1E1E1E;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #FDB714;
        }
        .success { border-left-color: #34C759; }
        .error { border-left-color: #FF3B30; }
        pre {
            background: #000;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Nassim Portal Debug</h1>
    <div id="results"></div>

    <script>
        const results = document.getElementById('results');
        const BUSINESS_ID = '69259331651b1babc1eb83dc';
        
        function log(message, type = 'status') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
            console.log(message.replace(/<[^>]*>/g, ''));
        }

        async function runDiagnostics() {
            log('ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´Ø®ÙŠØµ...');
            
            // Test 1: Check localStorage
            log('<h3>1ï¸âƒ£ ÙØ­Øµ localStorage</h3>');
            const token = localStorage.getItem('customerToken');
            if (token) {
                log(`âœ… Token Ù…ÙˆØ¬ÙˆØ¯: ${token.substring(0, 20)}...`, 'success');
            } else {
                log('âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ token (ÙˆØ¶Ø¹ Ø§Ù„Ø²Ø§Ø¦Ø±)', 'status');
            }
            
            // Test 2: Test Posts API
            log('<h3>2ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Posts API</h3>');
            try {
                const postsResponse = await fetch(`/api/posts/public/${BUSINESS_ID}`);
                log(`Status: ${postsResponse.status} ${postsResponse.statusText}`);
                
                const postsData = await postsResponse.json();
                log(`Success: ${postsData.success}`, postsData.success ? 'success' : 'error');
                
                if (postsData.data) {
                    log(`ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª: ${postsData.data.length}`, 'success');
                    postsData.data.forEach((post, i) => {
                        log(`   ${i+1}. ${post.title}`);
                    });
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Posts API: ${error.message}`, 'error');
            }
            
            // Test 3: Test Rewards API
            log('<h3>3ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Rewards API</h3>');
            try {
                const rewardsResponse = await fetch(`/api/rewards/public/${BUSINESS_ID}`);
                log(`Status: ${rewardsResponse.status}`);
                
                const rewardsData = await rewardsResponse.json();
                log(`Success: ${rewardsData.success}`, rewardsData.success ? 'success' : 'error');
                
                if (rewardsData.data) {
                    log(`ğŸ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª: ${rewardsData.data.length}`, 'success');
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Rewards API: ${error.message}`, 'error');
            }
            
            // Test 4: Check if nassim.js loads
            log('<h3>4ï¸âƒ£ ÙØ­Øµ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª</h3>');
            try {
                const cssResponse = await fetch('/nassim/style.css');
                log(`CSS: ${cssResponse.status}`, cssResponse.ok ? 'success' : 'error');
                
                const jsResponse = await fetch('/nassim/nassim.js');
                log(`JS: ${jsResponse.status}`, jsResponse.ok ? 'success' : 'error');
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª: ${error.message}`, 'error');
            }
            
            // Test 5: Check DOM elements
            log('<h3>5ï¸âƒ£ ÙØ­Øµ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø©</h3>');
            const elements = [
                'postsList',
                'rewardsList',
                'userInfo',
                'pointsDisplay'
            ];
            
            elements.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    log(`âœ… ${id} Ù…ÙˆØ¬ÙˆØ¯`, 'success');
                } else {
                    log(`âŒ ${id} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯`, 'error');
                }
            });
            
            log('<h3>âœ… Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ØªØ´Ø®ÙŠØµ</h3>', 'success');
            log('<p><a href="/nassim" style="color: #FDB714;">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØµÙØ­Ø© Nassim</a></p>');
        }

        runDiagnostics();
    </script>
</body>
</html>
