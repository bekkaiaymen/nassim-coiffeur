# ุชุญุฏูุซุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช - ูุงุฌูุฉ ุงูุฒุจูู

## ุงูููุงุฐุฌ ุงูุฌุฏูุฏุฉ (Models)

ุชู ุฅูุดุงุก 4 ููุงุฐุฌ ุฌุฏูุฏุฉ ูุฑุจุท ูุงุฌูุฉ ุงูุฒุจูู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช:

### 1. Message (ุงูุฑุณุงุฆู)
```javascript
models/Message.js
```
- **ุงูุบุฑุถ**: ุชูุนูู ูุธุงู ุงูุฑุณุงุฆู ุจูู ุงูุนููุงุก ูุงููุญูุงุช
- **ุงูุญููู ุงูุฑุฆูุณูุฉ**:
  - `sender`: ุงููุฑุณู (customer ุฃู business)
  - `content`: ูุญุชูู ุงูุฑุณุงูุฉ
  - `read`: ุญุงูุฉ ุงููุฑุงุกุฉ
  - `readAt`: ุชุงุฑูุฎ ุงููุฑุงุกุฉ

### 2. Review (ุงูุชููููุงุช)
```javascript
models/Review.js
```
- **ุงูุบุฑุถ**: ูุธุงู ุชููููุงุช ุงุญุชุฑุงูู
- **ุงูุญููู ุงูุฑุฆูุณูุฉ**:
  - `rating`: ุงูุชูููู (1-5)
  - `title`: ุนููุงู ุงูุชูููู
  - `comment`: ูุต ุงูุชูููู
  - `tags`: ุชุตูููุงุช (service, clean, price, time, quality, friendly)
  - `response`: ุฑุฏ ุงููุญู ุนูู ุงูุชูููู
  - `status`: ุญุงูุฉ ุงูููุงููุฉ (pending, approved, rejected)

### 3. Favorite (ุงูููุถูุฉ)
```javascript
models/Favorite.js
```
- **ุงูุบุฑุถ**: ุญูุธ ุงููุญูุงุช ุงูููุถูุฉ ููุนููู
- **ุงูุญููู ุงูุฑุฆูุณูุฉ**:
  - `user`: ุงููุณุชุฎุฏู
  - `customer`: ุงูุนููู
  - `business`: ุงููุญู
- **ููุฒุงุช**: ููุฑุณ ูุฑูุฏ ูููุน ุงูุชูุฑุงุฑ

### 4. Notification (ุงูุฅุดุนุงุฑุงุช)
```javascript
models/Notification.js
```
- **ุงูุบุฑุถ**: ูุธุงู ุฅุดุนุงุฑุงุช ูุชูุงูู
- **ุฃููุงุน ุงูุฅุดุนุงุฑุงุช**:
  - booking_confirmed: ุชุฃููุฏ ุงูุญุฌุฒ
  - booking_reminder: ุชุฐููุฑ ุจุงูููุนุฏ
  - booking_cancelled: ุฅูุบุงุก ุงูุญุฌุฒ
  - review_request: ุทูุจ ุชูููู
  - promotion: ุนุฑูุถ ุฎุงุตุฉ
  - message: ุฑุณุงูุฉ ุฌุฏูุฏุฉ
  - general: ุนุงู

## ุงูู Routes ุงูุฌุฏูุฏุฉ (API Endpoints)

### 1. Messages API (`/api/messages`)

#### GET `/customer/:customerId`
- **ุงูุบุฑุถ**: ุฌูุจ ุฑุณุงุฆู ุงูุนููู
- **ุงููุตุงุฏูุฉ**: ูุทููุจุฉ
- **ุงูุงุณุชุฌุงุจุฉ**: 
  ```json
  {
    "success": true,
    "data": {
      "messages": [...],
      "conversations": [...]
    }
  }
  ```

#### POST `/send`
- **ุงูุบุฑุถ**: ุฅุฑุณุงู ุฑุณุงูุฉ
- **ุงููุตุงุฏูุฉ**: ูุทููุจุฉ
- **ุงูุจูุงูุงุช ุงููุทููุจุฉ**:
  ```json
  {
    "customerId": "...",
    "businessId": "...",
    "content": "..."
  }
  ```

#### PATCH `/:id/read`
- **ุงูุบุฑุถ**: ูุถุน ุนูุงูุฉ ููุฑูุก
- **ุงููุตุงุฏูุฉ**: ูุทููุจุฉ

---

### 2. Reviews API (`/api/reviews`)

#### GET `/business/:businessId` (Public)
- **ุงูุบุฑุถ**: ุฌูุจ ุชููููุงุช ุงููุญู
- **ุงููุตุงุฏูุฉ**: ุบูุฑ ูุทููุจุฉ
- **ุงููุนุงููุงุช**:
  - `status`: ุญุงูุฉ ุงูุชูููู (ุงูุชุฑุงุถู: approved)
  - `rating`: ููุชุฑ ุญุณุจ ุงูุชูููู (1-5)
  - `limit`: ุนุฏุฏ ุงููุชุงุฆุฌ (ุงูุชุฑุงุถู: 50)
- **ุงูุงุณุชุฌุงุจุฉ**:
  ```json
  {
    "success": true,
    "data": [...],
    "stats": {
      "averageRating": 4.5,
      "totalReviews": 120,
      "rating5": 80,
      "rating4": 30,
      "rating3": 5,
      "rating2": 3,
      "rating1": 2
    }
  }
  ```

#### GET `/customer/:customerId`
- **ุงูุบุฑุถ**: ุฌูุจ ุชููููุงุช ุงูุนููู
- **ุงููุตุงุฏูุฉ**: ูุทููุจุฉ

#### POST `/create`
- **ุงูุบุฑุถ**: ุฅูุดุงุก ุชูููู ุฌุฏูุฏ
- **ุงููุตุงุฏูุฉ**: ูุทููุจุฉ
- **ุงูุจูุงูุงุช ุงููุทููุจุฉ**:
  ```json
  {
    "customerId": "...",
    "businessId": "...",
    "rating": 5,
    "title": "ุฎุฏูุฉ ููุชุงุฒุฉ",
    "comment": "ุชุฌุฑุจุฉ ุฑุงุฆุนุฉ...",
    "tags": ["service", "clean"]
  }
  ```

#### PUT `/:id`
- **ุงูุบุฑุถ**: ุชุนุฏูู ุชูููู
- **ุงููุตุงุฏูุฉ**: ูุทููุจุฉ

#### DELETE `/:id`
- **ุงูุบุฑุถ**: ุญุฐู ุชูููู
- **ุงููุตุงุฏูุฉ**: ูุทููุจุฉ

---

### 3. Favorites API (`/api/favorites`)

#### GET `/customer/:customerId`
- **ุงูุบุฑุถ**: ุฌูุจ ููุถูุฉ ุงูุนููู
- **ุงููุตุงุฏูุฉ**: ูุทููุจุฉ

#### GET `/user`
- **ุงูุบุฑุถ**: ุฌูุจ ุฌููุน ุงูููุถูุฉ ูููุณุชุฎุฏู
- **ุงููุตุงุฏูุฉ**: ูุทููุจุฉ

#### GET `/check/:customerId/:businessId`
- **ุงูุบุฑุถ**: ุงูุชุญูู ูู ุงูููุถูุฉ
- **ุงููุตุงุฏูุฉ**: ูุทููุจุฉ

#### POST `/add`
- **ุงูุบุฑุถ**: ุฅุถุงูุฉ ููููุถูุฉ
- **ุงููุตุงุฏูุฉ**: ูุทููุจุฉ
- **ุงูุจูุงูุงุช ุงููุทููุจุฉ**:
  ```json
  {
    "customerId": "...",
    "businessId": "..."
  }
  ```

#### DELETE `/remove/:businessId`
- **ุงูุบุฑุถ**: ุฅุฒุงูุฉ ูู ุงูููุถูุฉ
- **ุงููุตุงุฏูุฉ**: ูุทููุจุฉ

#### POST `/toggle`
- **ุงูุบุฑุถ**: ุชุจุฏูู ุงูููุถูุฉ (ุฅุถุงูุฉ/ุฅุฒุงูุฉ)
- **ุงููุตุงุฏูุฉ**: ูุทููุจุฉ
- **ุงูุจูุงูุงุช ุงููุทููุจุฉ**:
  ```json
  {
    "customerId": "...",
    "businessId": "..."
  }
  ```
- **ุงูุงุณุชุฌุงุจุฉ**:
  ```json
  {
    "success": true,
    "isFavorite": true,
    "message": "ุชูุช ุงูุฅุถุงูุฉ ุฅูู ุงูููุถูุฉ"
  }
  ```

---

### 4. Notifications API (`/api/notifications`)

#### GET `/customer/:customerId`
- **ุงูุบุฑุถ**: ุฌูุจ ุฅุดุนุงุฑุงุช ุงูุนููู
- **ุงููุตุงุฏูุฉ**: ูุทููุจุฉ
- **ุงููุนุงููุงุช**:
  - `limit`: ุนุฏุฏ ุงููุชุงุฆุฌ (ุงูุชุฑุงุถู: 50)
  - `unreadOnly`: ููุท ุบูุฑ ุงูููุฑูุกุฉ (true/false)
- **ุงูุงุณุชุฌุงุจุฉ**:
  ```json
  {
    "success": true,
    "data": [...],
    "unreadCount": 5
  }
  ```

#### GET `/user`
- **ุงูุบุฑุถ**: ุฌูุจ ุฌููุน ุงูุฅุดุนุงุฑุงุช
- **ุงููุตุงุฏูุฉ**: ูุทููุจุฉ

#### POST `/create`
- **ุงูุบุฑุถ**: ุฅูุดุงุก ุฅุดุนุงุฑ
- **ุงููุตุงุฏูุฉ**: ูุทููุจุฉ
- **ุงูุจูุงูุงุช ุงููุทููุจุฉ**:
  ```json
  {
    "customerId": "...",
    "businessId": "...",
    "type": "booking_confirmed",
    "title": "ุชู ุชุฃููุฏ ุญุฌุฒู",
    "message": "...",
    "icon": "โ"
  }
  ```

#### PATCH `/:id/read`
- **ุงูุบุฑุถ**: ูุถุน ุนูุงูุฉ ููุฑูุก
- **ุงููุตุงุฏูุฉ**: ูุทููุจุฉ

#### PATCH `/read-all`
- **ุงูุบุฑุถ**: ูุถุน ุนูุงูุฉ ุนูู ุงููู ูููุฑูุก
- **ุงููุตุงุฏูุฉ**: ูุทููุจุฉ
- **ุงูุจูุงูุงุช ุงูุงุฎุชูุงุฑูุฉ**:
  ```json
  {
    "customerId": "..."
  }
  ```

#### DELETE `/:id`
- **ุงูุบุฑุถ**: ุญุฐู ุฅุดุนุงุฑ
- **ุงููุตุงุฏูุฉ**: ูุทููุจุฉ

#### DELETE `/user/all`
- **ุงูุบุฑุถ**: ุญุฐู ุฌููุน ุงูุฅุดุนุงุฑุงุช
- **ุงููุตุงุฏูุฉ**: ูุทููุจุฉ
- **ุงููุนุงููุงุช**:
  - `customerId`: ูุนุฑู ุงูุนููู (ุงุฎุชูุงุฑู)
  - `readOnly`: ููุท ุงูููุฑูุกุฉ (true/false)

---

## ุงูุชุญุฏูุซุงุช ูู Frontend

ุชู ุชุญุฏูุซ `public/customer/customer.js` ูุฑุจุทู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช:

### 1. ุงูุฅุดุนุงุฑุงุช
- โ `loadNotifications()`: ุชุญููู ูู `/api/notifications/user`
- โ `markAsRead()`: ุชุญุฏูุซ ุญุงูุฉ ุงููุฑุงุกุฉ
- โ ุฏุงูุฉ `getTimeAgo()`: ุญุณุงุจ ุงูููุช ุงููููุถู

### 2. ุงูุญุฌูุฒุงุช
- โ `loadBookingHistory()`: ุชุญููู ูู `/api/appointments/public/customer/:phone`
- โ `cancelBooking()`: ุฅูุบุงุก ุนุจุฑ API
- โ ุนุฑุถ ุงูุจูุงูุงุช ุงููุนููุฉ ูุน ุงูุญุงูุงุช ุงูุตุญูุญุฉ

### 3. ุงูููุถูุฉ
- โ `loadFavoritesPage()`: ุชุญููู ูู `/api/favorites/user`
- โ `toggleFavorite()`: ุชุจุฏูู ุนุจุฑ `/api/favorites/toggle`
- โ `loadUserFavorites()`: ุชุญููู ุนูุฏ ุจุฏุก ุงูุชุดุบูู
- โ ูุฒุงููุฉ ุชููุงุฆูุฉ ุนูุฏ ุงูุชุบููุฑ

### 4. ุงูุชููููุงุช
- โ `submitReview()`: ุฅุฑุณุงู ุฅูู `/api/reviews/create`
- โ `loadReviews()`: ุชุญููู ูู `/api/reviews/business/:id`
- โ `loadBusinessReviews()`: ุนุฑุถ ุงูุชููููุงุช ูู ุตูุญุฉ ุงูุชูุงุตูู
- โ ุฏุงูุฉ `getTagLabel()`: ุชุฑุฌูุฉ ุงูุชุตูููุงุช

---

## ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### 1. Multi-tenancy
- ุฌููุน ุงูููุงุฐุฌ ุชุฏุนู ุนุฒู ุงูุจูุงูุงุช ุญุณุจ ุงูู tenant
- ุงูููุงุฑุณ ูุญุณููุฉ ููุงุณุชุนูุงูุงุช ุงูุณุฑูุนุฉ

### 2. ุงููุตุงุฏูุฉ ูุงูุฃูุงู
- ุฌููุน ุงูู endpoints ูุญููุฉ ุจู JWT
- ุงูุชุญูู ูู ููููุฉ ุงูุจูุงูุงุช ูุจู ุงููุตูู
- ููุน ุงูุนูููุงุช ุบูุฑ ุงููุตุฑุญ ุจูุง

### 3. ุงูุฃุฏุงุก
- ููุงุฑุณ ุนูู ุงูุญููู ุงูุฃุณุงุณูุฉ
- Populate ููุญุตูู ุนูู ุงูุจูุงูุงุช ุงููุฑุชุจุทุฉ
- ุชุญุฏูุฏ ุนุฏุฏ ุงููุชุงุฆุฌ ูุชุญุณูู ุงูุฃุฏุงุก

### 4. ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุจุงูุนุฑุจูุฉ
- ุชุญููู ุชููุงุฆู ููุจูุงูุงุช
- ูุฒุงููุฉ ููุฑูุฉ ุจูู ุงูุตูุญุงุช

---

## ุงูุงุฎุชุจุงุฑ

### ุงุณุชุฎุฏุงู Thunder Client / Postman

#### 1. ุชุณุฌูู ุงูุฏุฎูู
```
POST /api/customers/login
{
  "phone": "0500000000",
  "password": "password"
}
```
ุงุญูุธ ุงูู token ูู ุงูุงุณุชุฌุงุจุฉ.

#### 2. ุฌูุจ ุงูุฅุดุนุงุฑุงุช
```
GET /api/notifications/user
Headers: Authorization: Bearer YOUR_TOKEN
```

#### 3. ุฅุถุงูุฉ ููููุถูุฉ
```
POST /api/favorites/toggle
Headers: Authorization: Bearer YOUR_TOKEN
Body: {
  "customerId": "customer_id",
  "businessId": "business_id"
}
```

#### 4. ูุชุงุจุฉ ุชูููู
```
POST /api/reviews/create
Headers: Authorization: Bearer YOUR_TOKEN
Body: {
  "customerId": "customer_id",
  "businessId": "business_id",
  "rating": 5,
  "title": "ุฎุฏูุฉ ุฑุงุฆุนุฉ",
  "comment": "ุชุฌุฑุจุฉ ููุชุงุฒุฉ...",
  "tags": ["service", "clean"]
}
```

---

## ุงููุดุงูู ุงููุญุชููุฉ ูุงูุญููู

### 1. ุฎุทุฃ 403: ุบูุฑ ูุตุฑุญ ูู ุจุงููุตูู
- **ุงูุณุจุจ**: ุงูู token ุบูุฑ ุตุญูุญ ุฃู ููุชูู ุงูุตูุงุญูุฉ
- **ุงูุญู**: ุชุณุฌูู ุฏุฎูู ุฌุฏูุฏ ููุญุตูู ุนูู token ุฌุฏูุฏ

### 2. ุงูููุถูุฉ ูุง ุชุธูุฑ
- **ุงูุณุจุจ**: ูู ูุชู ุชุญููููุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **ุงูุญู**: ุงูุชุฃูุฏ ูู ุงุณุชุฏุนุงุก `loadUserFavorites()` ูู DOMContentLoaded

### 3. ุงูุชููููุงุช ูุง ุชุธูุฑ
- **ุงูุณุจุจ**: ูู ูุชู ุงุณุชุฏุนุงุก `loadBusinessReviews()`
- **ุงูุญู**: ุงูุชุฃูุฏ ูู ุงุณุชุฏุนุงุฆูุง ูู `showShopDetails()`

### 4. ุงูุฅุดุนุงุฑุงุช ูุง ุชุชุญุฏุซ
- **ุงูุณุจุจ**: ูู ูุชู ุงุณุชุฏุนุงุก API ุนูุฏ ุนุฑุถ ุงูุตูุญุฉ
- **ุงูุญู**: ุงูุชุฃูุฏ ูู ุงุณุชุฏุนุงุก `loadNotifications()` ูู `showNotifications()`

---

## ุงููููุงุช ุงููุญุฏุซุฉ

```
โ models/Message.js (ุฌุฏูุฏ)
โ models/Review.js (ุฌุฏูุฏ)
โ models/Favorite.js (ุฌุฏูุฏ)
โ models/Notification.js (ุฌุฏูุฏ)
โ routes/messages.js (ุฌุฏูุฏ)
โ routes/reviews.js (ุฌุฏูุฏ)
โ routes/favorites.js (ุฌุฏูุฏ)
โ routes/notifications.js (ุฌุฏูุฏ)
โ server.js (ุชุญุฏูุซ - ุฅุถุงูุฉ routes)
โ public/customer/customer.js (ุชุญุฏูุซ - ุฑุจุท ุจุงูู API)
```

---

## ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑู)

1. **ุชุญุณูู ุงูุฃุฏุงุก**:
   - ุฅุถุงูุฉ caching ููุจูุงูุงุช
   - Pagination ูููุชุงุฆุฌ ุงููุจูุฑุฉ

2. **ููุฒุงุช ุฅุถุงููุฉ**:
   - ุฑูุน ุงูุตูุฑ ูุน ุงูุชููููุงุช
   - ูุธุงู ุงูุฑุณุงุฆู ุงูููุฑูุฉ (WebSocket)
   - ุฅุดุนุงุฑุงุช Push

3. **ุงูุชุญูููุงุช**:
   - ุชุชุจุน ุณููู ุงููุณุชุฎุฏู
   - ุฅุญุตุงุฆูุงุช ุงูุชููููุงุช
   - ุชูุงุฑูุฑ ุงูุญุฌูุฒุงุช

---

ุชู ุจูุฌุงุญ ุฑุจุท ูุงุฌูุฉ ุงูุฒุจูู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช! ๐
